# FinMod-Copilot æœ¬åœ°ä½¿ç”¨æŒ‡å—

## ğŸ“‹ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /workspaces/RM_Tools/finmod_copilot

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. è·å– Gemini API å¯†é’¥

1. è®¿é—® [Google AI Studio](https://makersuite.google.com/app/apikey)
2. ä½¿ç”¨ Google è´¦å·ç™»å½•
3. ç‚¹å‡» "åˆ›å»º API å¯†é’¥" æˆ– "Get API Key"
4. å¤åˆ¶ç”Ÿæˆçš„ API å¯†é’¥

### 3. è®¾ç½® API å¯†é’¥

**æ–¹å¼ä¸€ï¼šè®¾ç½®ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**

```bash
# Linux/Mac
export GOOGLE_API_KEY='ä½ çš„APIå¯†é’¥'

# Windows CMD
set GOOGLE_API_KEY=ä½ çš„APIå¯†é’¥

# Windows PowerShell
$env:GOOGLE_API_KEY='ä½ çš„APIå¯†é’¥'
```

**æ–¹å¼äºŒï¼šåœ¨ä»£ç ä¸­è®¾ç½®**

```python
import os
os.environ['GOOGLE_API_KEY'] = 'ä½ çš„APIå¯†é’¥'
```

### 4. è¿è¡Œæ¼”ç¤ºç¨‹åº

```bash
# ç¡®ä¿åœ¨é¡¹ç›®æ ¹ç›®å½•
cd /workspaces/RM_Tools

# è¿è¡Œ Gemini æ¼”ç¤º
python -m finmod_copilot.examples.demo_gemini
```

## ğŸ’¡ åŸºæœ¬ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šç¿»è¯‘ç®€å•çš„ Excel å…¬å¼

```python
from finmod_copilot.translation.llm_translator import LLMTranslator

# åˆå§‹åŒ–ç¿»è¯‘å™¨ï¼ˆä½¿ç”¨ Geminiï¼‰
translator = LLMTranslator(
    provider="gemini",
    model="gemini-1.5-pro",
    temperature=0.1
)

# Excel å…¬å¼
formula = "=SUM(A1:A10)"

# ç¿»è¯‘
prompt = f"å°†è¿™ä¸ª Excel å…¬å¼è½¬æ¢ä¸º Python ä»£ç ï¼š{formula}"
python_code = translator.translate(prompt)

print(python_code)
```

### ç¤ºä¾‹ 2ï¼šè§£æ Excel æ–‡ä»¶

```python
from finmod_copilot.core.excel_parser import ExcelParser

# åˆ›å»ºè§£æå™¨
parser = ExcelParser()

# è§£æ Excel æ–‡ä»¶
structure = parser.parse("ä½ çš„è´¢åŠ¡æ¨¡å‹.xlsx")

# æŸ¥çœ‹æ–‡ä»¶ç»“æ„
print(f"å·¥ä½œè¡¨æ•°é‡: {len(structure.sheets)}")
print(f"å‘½åèŒƒå›´: {list(structure.named_ranges.keys())}")
print(f"æ˜¯å¦åŒ…å« VBA: {structure.has_vba}")

# è·å–æ‰€æœ‰å…¬å¼
formulas = parser.get_formulas()
print(f"å…¬å¼æ€»æ•°: {len(formulas)}")

# æŸ¥çœ‹å‰5ä¸ªå…¬å¼
for i, cell in enumerate(formulas[:5]):
    print(f"{i+1}. {cell.sheet_name}!{cell.address}: {cell.formula}")
```

### ç¤ºä¾‹ 3ï¼šåˆ†æå…¬å¼ä¾èµ–å…³ç³»

```python
from finmod_copilot.core.excel_parser import ExcelParser
from finmod_copilot.core.dependency_graph import DependencyGraph

# è§£æ Excel
parser = ExcelParser()
structure = parser.parse("è´¢åŠ¡æ¨¡å‹.xlsx")

# æ„å»ºä¾èµ–å›¾
graph = DependencyGraph(structure)
graph.build()

# è·å–è®¡ç®—é¡ºåº
calc_order = graph.get_calculation_order()
print(f"è®¡ç®—å±‚çº§æ•°: {len(calc_order)}")

# æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯
stats = graph.export_stats()
print(f"æ€»å•å…ƒæ ¼æ•°: {stats['total_cells']}")
print(f"å…¬å¼å•å…ƒæ ¼æ•°: {stats['formula_cells']}")
print(f"è¾“å…¥å•å…ƒæ ¼æ•°: {stats['input_cells']}")
```

### ç¤ºä¾‹ 4ï¼šå®Œæ•´çš„å…¬å¼ç¿»è¯‘æµç¨‹

```python
from finmod_copilot.core.excel_parser import ExcelParser
from finmod_copilot.core.formula_parser import FormulaParser
from finmod_copilot.translation.llm_translator import LLMTranslator

# 1. è§£æ Excel æ–‡ä»¶
excel_parser = ExcelParser()
structure = excel_parser.parse("è´¢åŠ¡æ¨¡å‹.xlsx")

# 2. è·å–æ‰€æœ‰å…¬å¼
formulas = excel_parser.get_formulas()

# 3. åˆå§‹åŒ– LLM ç¿»è¯‘å™¨
translator = LLMTranslator(provider="gemini")

# 4. åˆ†æå’Œç¿»è¯‘å…¬å¼
formula_parser = FormulaParser()

for cell in formulas[:3]:  # ç¿»è¯‘å‰3ä¸ªå…¬å¼ä½œä¸ºç¤ºä¾‹
    # è§£æå…¬å¼
    parsed = formula_parser.parse(cell.formula)
    
    print(f"\n{'='*60}")
    print(f"ä½ç½®: {cell.sheet_name}!{cell.address}")
    print(f"åŸå§‹å…¬å¼: {cell.formula}")
    print(f"å…¬å¼ç±»å‹: {parsed.formula_type.value}")
    print(f"å¤æ‚åº¦: {parsed.complexity_score}/100")
    
    # æ„å»ºç¿»è¯‘æç¤º
    prompt = f"""å°†ä»¥ä¸‹ Excel å…¬å¼è½¬æ¢ä¸º Python ä»£ç ï¼š

åŸå§‹å…¬å¼: {cell.formula}
ä½ç½®: {cell.sheet_name}!{cell.address}
ç±»å‹: {parsed.formula_type.value}

è¦æ±‚ï¼š
1. ä½¿ç”¨ pandas DataFrame æ“ä½œ
2. æ·»åŠ æº¯æºæ³¨é‡Š
3. å¤„ç†è¾¹ç•Œæƒ…å†µ
4. ä½¿ç”¨å‘é‡åŒ–æ“ä½œï¼ˆå¦‚æœå¯èƒ½ï¼‰

å‡è®¾æ•°æ®åœ¨ DataFrame 'df' ä¸­ï¼Œå·¥ä½œè¡¨åç§°ä½œä¸ºå­—å…¸é”®ã€‚
"""
    
    # ç¿»è¯‘
    python_code = translator.translate(
        prompt,
        system_prompt="ä½ æ˜¯ Excel åˆ° Python è½¬æ¢ä¸“å®¶ï¼Œä¸“æ³¨äºé‡‘èå»ºæ¨¡ã€‚"
    )
    
    print(f"\nPython ä»£ç :\n{python_code}")
```

## ğŸ”§ å¸¸ç”¨é…ç½®

### é€‰æ‹©ä¸åŒçš„ Gemini æ¨¡å‹

```python
# ä½¿ç”¨ Pro ç‰ˆæœ¬ï¼ˆæ›´å¥½çš„è´¨é‡ï¼Œé€‚åˆå¤æ‚å…¬å¼ï¼‰
translator = LLMTranslator(
    provider="gemini",
    model="gemini-1.5-pro"
)

# ä½¿ç”¨ Flash ç‰ˆæœ¬ï¼ˆæ›´å¿«æ›´ä¾¿å®œï¼Œé€‚åˆç®€å•å…¬å¼ï¼‰
translator = LLMTranslator(
    provider="gemini",
    model="gemini-1.5-flash"
)
```

### è°ƒæ•´ç¿»è¯‘å‚æ•°

```python
translator = LLMTranslator(
    provider="gemini",
    model="gemini-1.5-pro",
    temperature=0.1,      # é™ä½éšæœºæ€§ï¼Œæé«˜ä¸€è‡´æ€§
    max_tokens=4096,      # æœ€å¤§è¾“å‡ºé•¿åº¦
    max_retries=3,        # API é”™è¯¯é‡è¯•æ¬¡æ•°
    timeout=60            # è¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰
)
```

## ğŸ“ é¡¹ç›®æ–‡ä»¶ç»“æ„

```
finmod_copilot/
â”œâ”€â”€ æœ¬åœ°ä½¿ç”¨æŒ‡å—.md          â† ä½ æ­£åœ¨çœ‹çš„æ–‡ä»¶
â”œâ”€â”€ README.md               â† é¡¹ç›®æ€»è§ˆ
â”œâ”€â”€ GEMINI_GUIDE.md         â† Gemini è¯¦ç»†ä½¿ç”¨æŒ‡å—
â”œâ”€â”€ requirements.txt        â† Python ä¾èµ–
â”‚
â”œâ”€â”€ core/                   â† æ ¸å¿ƒè§£ææ¨¡å—
â”‚   â”œâ”€â”€ excel_parser.py     # Excel æ–‡ä»¶è§£æ
â”‚   â”œâ”€â”€ formula_parser.py   # å…¬å¼åˆ†æ
â”‚   â”œâ”€â”€ dependency_graph.py # ä¾èµ–å…³ç³»å›¾
â”‚   â””â”€â”€ vba_extractor.py    # VBA ä»£ç æå–
â”‚
â”œâ”€â”€ translation/            â† LLM ç¿»è¯‘å±‚
â”‚   â””â”€â”€ llm_translator.py   # å¤šæ¨¡å‹ç¿»è¯‘å™¨
â”‚
â””â”€â”€ examples/               â† ç¤ºä¾‹ä»£ç 
    â””â”€â”€ demo_gemini.py      # Gemini æ¼”ç¤ºç¨‹åº
```

## ğŸ¯ å…¸å‹ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1ï¼šå°† Excel æ¨¡å‹è½¬ä¸º Python è„šæœ¬

```python
# 1. è§£æ Excel
parser = ExcelParser()
structure = parser.parse("valuation_model.xlsx")

# 2. æå–å…³é”®å…¬å¼
formulas = parser.get_formulas("Calculations")  # ç‰¹å®šå·¥ä½œè¡¨

# 3. é€ä¸ªç¿»è¯‘å¹¶ä¿å­˜
translator = LLMTranslator(provider="gemini")
output_code = []

for cell in formulas:
    python_code = translator.translate(
        f"è½¬æ¢å…¬å¼åˆ°Python: {cell.formula}"
    )
    output_code.append(python_code)

# 4. ä¿å­˜ç»“æœ
with open("output_model.py", "w", encoding="utf-8") as f:
    f.write("\n\n".join(output_code))
```

### åœºæ™¯ 2ï¼šæå–å¹¶ç¿»è¯‘ VBA å®

```python
from finmod_copilot.core.vba_extractor import VBAExtractor

# æå– VBA
extractor = VBAExtractor()
vba_structure = extractor.extract("model_with_macros.xlsm")

if vba_structure:
    # è·å–ä¸šåŠ¡é€»è¾‘å‡½æ•°
    business_funcs = extractor.get_business_logic_functions(vba_structure)
    
    # ç¿»è¯‘ VBA å‡½æ•°
    translator = LLMTranslator(provider="gemini")
    
    for func in business_funcs[:5]:
        print(f"\nåŸå§‹ VBA:\n{func.code}")
        
        prompt = f"""å°†æ­¤ VBA å‡½æ•°è½¬æ¢ä¸º Python:

{func.code}

è¦æ±‚ï¼š
1. ä½¿ç”¨ç±»å‹æç¤º
2. æ·»åŠ æ–‡æ¡£å­—ç¬¦ä¸²
3. éµå¾ª Python å‘½åè§„èŒƒ
"""
        python_code = translator.translate(prompt)
        print(f"\nPython ä»£ç :\n{python_code}")
```

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API å¯†é’¥å®‰å…¨**
   - ä¸è¦å°† API å¯†é’¥æäº¤åˆ° Git
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥
   - å®šæœŸæ›´æ¢å¯†é’¥

2. **é€Ÿç‡é™åˆ¶**
   - Gemini å…è´¹ç‰ˆï¼š60 è¯·æ±‚/åˆ†é’Ÿ
   - å¦‚é‡åˆ°é™åˆ¶ï¼Œæ·»åŠ å»¶æ—¶ï¼š`time.sleep(1)`

3. **æˆæœ¬æ§åˆ¶**
   - Gemini 1.5 Flash æ›´ä¾¿å®œï¼Œé€‚åˆç®€å•ä»»åŠ¡
   - å¯¹äº 1000 ä¸ªå…¬å¼ï¼ŒFlash çº¦ $0.06ï¼ŒPro çº¦ $1.00

4. **æ•°æ®éšç§**
   - æ•æ„Ÿè´¢åŠ¡æ•°æ®åœ¨å‘é€å‰è€ƒè™‘åŒ¿ååŒ–
   - æˆ–ä½¿ç”¨æœ¬åœ°éƒ¨ç½²çš„ LLMï¼ˆæœªæ¥æ”¯æŒï¼‰

## ğŸ› å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šæ‰¾ä¸åˆ°æ¨¡å—

```bash
# ç¡®ä¿åœ¨æ­£ç¡®çš„ç›®å½•
cd /workspaces/RM_Tools

# é‡æ–°å®‰è£…ä¾èµ–
pip install -r finmod_copilot/requirements.txt
```

### é—®é¢˜ 2ï¼šAPI å¯†é’¥é”™è¯¯

```python
# æ£€æŸ¥å¯†é’¥æ˜¯å¦è®¾ç½®
import os
print(os.getenv('GOOGLE_API_KEY'))

# å¦‚æœä¸º Noneï¼Œé‡æ–°è®¾ç½®
os.environ['GOOGLE_API_KEY'] = 'ä½ çš„å¯†é’¥'
```

### é—®é¢˜ 3ï¼šExcel æ–‡ä»¶æ— æ³•è§£æ

```python
# ç¡®ä¿æ–‡ä»¶è·¯å¾„æ­£ç¡®
from pathlib import Path
file_path = Path("ä½ çš„æ–‡ä»¶.xlsx")
print(f"æ–‡ä»¶å­˜åœ¨: {file_path.exists()}")
print(f"ç»å¯¹è·¯å¾„: {file_path.absolute()}")
```

## ğŸ“š æ›´å¤šèµ„æº

- **è¯¦ç»†æ–‡æ¡£**: æŸ¥çœ‹ [GEMINI_GUIDE.md](GEMINI_GUIDE.md)
- **æ¶æ„è¯´æ˜**: æŸ¥çœ‹ [ARCHITECTURE.md](ARCHITECTURE.md)
- **API æ–‡æ¡£**: https://ai.google.dev/docs
- **è·å– API å¯†é’¥**: https://makersuite.google.com/app/apikey

## ğŸ’¬ è·å–å¸®åŠ©

å¦‚æœ‰é—®é¢˜ï¼š
1. æŸ¥çœ‹ [GEMINI_GUIDE.md](GEMINI_GUIDE.md) çš„æ•…éšœæ’é™¤éƒ¨åˆ†
2. æ£€æŸ¥ GitHub Issues
3. è¿è¡Œæ¼”ç¤ºç¨‹åºæµ‹è¯•ç¯å¢ƒï¼š`python -m finmod_copilot.examples.demo_gemini`
